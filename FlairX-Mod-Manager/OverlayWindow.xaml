<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="FlairX_Mod_Manager.OverlayWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:FlairX_Mod_Manager"

    Title="FlairX Overlay">

    <Grid x:Name="MainRoot" Background="Transparent">
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Custom Title Bar -->
        <Grid x:Name="AppTitleBar" Grid.Row="0" Background="Transparent">
            <StackPanel Orientation="Horizontal" Margin="12,0,0,0" VerticalAlignment="Center">
                <Image Source="Assets/app.ico" Width="16" Height="16" Margin="0,0,8,0"/>
                <TextBlock x:Name="TitleBarTextBlock" Text="FlairX Mod Manager" FontSize="12" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
            </StackPanel>
        </Grid>

        <!-- Content -->
        <Grid Grid.Row="1" Padding="8,0,8,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="220" MinWidth="220" MaxWidth="220"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="280" MinWidth="280" MaxWidth="280" x:Name="HotkeysColumn"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Category Icons Column -->
            <ScrollViewer x:Name="CategoriesScrollViewer"
                          Grid.Column="0" Grid.Row="0"
                          Width="220"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Margin="0,0,8,0">
                <ItemsRepeater x:Name="CategoriesRepeater" 
                               ItemsSource="{x:Bind OverlayCategories}"
                               ElementPrepared="CategoriesRepeater_ElementPrepared">
                    <ItemsRepeater.Layout>
                        <StackLayout Orientation="Vertical" Spacing="4"/>
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="local:OverlayCategoryItem">
                            <Button Margin="2"
                                    Padding="0"
                                    CornerRadius="4"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Left"
                                    Click="CategoryItem_Click">
                                <Grid MinHeight="40" Margin="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="40"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Favorite Star (left side) -->
                                    <Button Grid.Column="0"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Padding="4"
                                            Width="28"
                                            Height="28"
                                            VerticalAlignment="Center"
                                            Click="CategoryFavoriteButton_Click"
                                            Tag="{x:Bind}">
                                        <FontIcon Glyph="{x:Bind FavoriteStarGlyph, Mode=OneWay}"
                                                  FontSize="14"
                                                  Foreground="{x:Bind FavoriteStarColor, Mode=OneWay}"/>
                                    </Button>
                                    
                                    <!-- Thumbnail -->
                                    <Grid Grid.Column="1" Width="40" Height="40">
                                        <!-- Selection background -->
                                        <Border CornerRadius="4"
                                                Background="{x:Bind SelectionBackground, Mode=OneWay}"/>
                                        <!-- Thumbnail image -->
                                        <Border CornerRadius="4"
                                                Visibility="{x:Bind ThumbnailVisibility}">
                                            <Image Source="{x:Bind Thumbnail}" 
                                                   Stretch="UniformToFill"/>
                                        </Border>
                                        <!-- Fallback icon (when no thumbnail) -->
                                        <FontIcon Glyph="{x:Bind FallbackGlyph}"
                                                  FontSize="20"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"
                                                  Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                  Visibility="{x:Bind FallbackVisibility}"/>
                                        <!-- Selection indicator -->
                                        <Border CornerRadius="4"
                                                BorderBrush="{x:Bind SelectionBorder, Mode=OneWay}"
                                                BorderThickness="2"/>
                                    </Grid>
                                    
                                    <!-- Category Name -->
                                    <TextBlock Grid.Column="2"
                                               Text="{x:Bind Name}"
                                               VerticalAlignment="Center"
                                               Margin="8,0,0,0"
                                               FontSize="13"
                                               Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                               TextWrapping="Wrap"/>
                                </Grid>
                            </Button>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </ScrollViewer>
            
            <!-- Vertical separator -->
            <Border Grid.Column="0" Grid.Row="0"
                    Width="1"
                    HorizontalAlignment="Right"
                    Margin="0,4"
                    Background="{ThemeResource DividerStrokeColorDefaultBrush}"
                    Opacity="0.3"/>

            <!-- Mod Grid -->
            <ScrollViewer x:Name="ModsScrollViewer"
                          Grid.Column="1" Grid.Row="0" 
                          Margin="8,0,8,0"
                          MinWidth="240"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
                <ItemsRepeater x:Name="ModsRepeater" 
                               ItemsSource="{x:Bind OverlayMods}"
                               ElementPrepared="ModsRepeater_ElementPrepared">
                    <ItemsRepeater.Layout>
                        <UniformGridLayout Orientation="Horizontal" 
                                           MinItemWidth="220" 
                                           MinItemHeight="262"
                                           MinRowSpacing="16" 
                                           MinColumnSpacing="16"
                                           ItemsStretch="None"/>
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="local:OverlayModItem">
                            <Button Padding="0"
                                    BorderThickness="0"
                                    Background="Transparent"
                                    HorizontalContentAlignment="Stretch"
                                    VerticalContentAlignment="Stretch"
                                    Click="ModItem_Click"
                                    RightTapped="ModItem_RightTapped"
                                    PointerEntered="ModTile_PointerEntered"
                                    PointerExited="ModTile_PointerExited">
                                <Grid Width="208" Height="250">
                                    <!-- Content with clipping -->
                                    <Border CornerRadius="6" 
                                            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                                        <Grid>
                                            <!-- Mod Image -->
                                            <Image x:Name="ModImage"
                                                   Source="{x:Bind Thumbnail}" 
                                                   Stretch="UniformToFill"
                                                   VerticalAlignment="Stretch"
                                                   HorizontalAlignment="Stretch"/>
                                            
                                            <!-- Caption Section -->
                                            <Grid VerticalAlignment="Bottom" Height="42">
                                                <!-- Inactive background (acrylic) -->
                                                <Border Background="{ThemeResource TileCaptionAcrylicBrush}" 
                                                        Visibility="{x:Bind InactiveVisibility, Mode=OneWay}"/>
                                                <!-- Active background (accent) -->
                                                <Border Background="{ThemeResource SystemAccentColor}" 
                                                        Visibility="{x:Bind ActiveVisibility, Mode=OneWay}"/>
                                                
                                                <!-- Mod Name (inactive) -->
                                                <TextBlock Text="{x:Bind Name}" 
                                                           FontWeight="SemiBold" 
                                                           FontSize="12" 
                                                           Padding="0" 
                                                           Margin="0"
                                                           Foreground="{ThemeResource TileCaptionForeground}" 
                                                           TextTrimming="CharacterEllipsis" 
                                                           TextAlignment="Center" 
                                                           VerticalAlignment="Center"
                                                           TextWrapping="NoWrap"
                                                           ToolTipService.ToolTip="{x:Bind Name}"
                                                           Visibility="{x:Bind InactiveVisibility, Mode=OneWay}"/>
                                                
                                                <!-- Mod Name (active - white text) -->
                                                <TextBlock Text="{x:Bind Name}" 
                                                           FontWeight="SemiBold" 
                                                           FontSize="12" 
                                                           Padding="0" 
                                                           Margin="0"
                                                           Foreground="White" 
                                                           TextTrimming="CharacterEllipsis" 
                                                           TextAlignment="Center" 
                                                           VerticalAlignment="Center"
                                                           TextWrapping="NoWrap"
                                                           ToolTipService.ToolTip="{x:Bind Name}"
                                                           Visibility="{x:Bind ActiveVisibility, Mode=OneWay}"/>
                                            </Grid>
                                        </Grid>
                                    </Border>
                                    
                                    <!-- Favorite Star Button (completely outside Border) -->
                                    <Button Width="28"
                                            Height="28"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Top"
                                            Margin="0,6,6,0"
                                            Padding="0"
                                            Background="{ThemeResource LauncherAcrylicBrush}"
                                            BorderThickness="0"
                                            CornerRadius="8"
                                            Click="ModFavoriteButton_Click"
                                            Tag="{x:Bind}">
                                        <FontIcon Glyph="{x:Bind FavoriteStarGlyph, Mode=OneWay}"
                                                  FontSize="16"
                                                  Foreground="{x:Bind FavoriteStarColor, Mode=OneWay}"
                                                  Margin="0"/>
                                    </Button>
                                    
                                    <!-- Selection border overlay -->
                                    <Border x:Name="TileBorder"
                                            CornerRadius="6"
                                            BorderBrush="{x:Bind SelectionBorderBrush, Mode=OneWay}"
                                            BorderThickness="3"/>
                                </Grid>
                            </Button>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </ScrollViewer>
            
            <!-- Vertical separator between mods and hotkeys -->
            <Border Grid.Column="1" Grid.Row="0"
                    Width="1"
                    HorizontalAlignment="Right"
                    Margin="4,8,4,8"
                    Background="{ThemeResource DividerStrokeColorDefaultBrush}"
                    x:Name="HotkeysSeparator">
                <Border.OpacityTransition>
                    <ScalarTransition Duration="0:0:0.25"/>
                </Border.OpacityTransition>
            </Border>

            <!-- Hotkeys Column -->
            <ScrollViewer x:Name="HotkeysScrollViewer"
                          Grid.Column="2" Grid.Row="0"
                          Margin="8,0,0,0"
                          Padding="0,0,8,0"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Visibility="Collapsed"
                          Opacity="0">
                <ScrollViewer.OpacityTransition>
                    <ScalarTransition Duration="0:0:0.3"/>
                </ScrollViewer.OpacityTransition>
                <ScrollViewer.TranslationTransition>
                    <Vector3Transition Duration="0:0:0.3"/>
                </ScrollViewer.TranslationTransition>
                <StackPanel Spacing="8">
                    <!-- Hotkeys Header -->
                    <TextBlock x:Name="HotkeysHeader" 
                               Text="Hotkeys" 
                               FontSize="16" 
                               FontWeight="SemiBold" 
                               Margin="0,0,0,8"
                               Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                    
                    <!-- Hotkeys List -->
                    <StackPanel x:Name="HotkeysList" Spacing="4"/>
                </StackPanel>
            </ScrollViewer>

            <!-- Footer -->
            <StackPanel Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Center"
                        Margin="0,8,0,0"
                        Spacing="8">
                <TextBlock x:Name="HotkeyHintText"
                           Text="" 
                           Opacity="0.5"
                           FontSize="11"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                <TextBlock Text="•" 
                           Opacity="0.5"
                           FontSize="11"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                <TextBlock x:Name="ClickToToggleText"
                           Text="" 
                           Opacity="0.5"
                           FontSize="11"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                <TextBlock x:Name="GamepadSeparator"
                           Text="•" 
                           Opacity="0.5"
                           FontSize="11"
                           Visibility="Collapsed"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                <TextBlock x:Name="GamepadHintText"
                           Text="" 
                           Opacity="0.5"
                           FontSize="11"
                           Visibility="Collapsed"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
